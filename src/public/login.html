<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Login - openplace</title>
	<link rel="stylesheet" href="/account.css">
</head>
<body>
	<div class="login-form">
		<h1>Welcome!</h1>
		<form id="loginForm">
			<div class="form-group">
				<input type="text" id="username" name="username" placeholder="Username" required>
			</div>
			<div class="form-group">
				<input type="password" id="password" name="password" placeholder="Password" required>
			</div>
			<input type="checkbox" id="betaSelect" name="betaSelect" value="betaSelect">Login to openplace beta</input>
			<button type="submit">Login</button>
			<div id="error" class="error"></div>
			<p class="agreement">By signing in, you agree to the rules set by the owner of this instance.</p>
		</form>
	</div>

	<script>
	document.getElementById("loginForm").addEventListener("submit", async (e) => {
		e.preventDefault();

		const username = document.getElementById("username").value;
		const password = document.getElementById("password").value;
		const errorDiv = document.getElementById("error");

		try {
			const response = await fetch("/login", {
				method: "POST",
				headers: {
					"Content-Type": "application/json",
				},
				body: JSON.stringify({ username, password })
			});

			const data = await response.json();

			if (response.ok) {
				if (betaSelect === TRUE){
					window.location.href = "/beta/";
				}
				else{
					window.location.href = "/";
			} else {
				errorDiv.textContent = data.error || "Login failed";
			}
		} catch (error) {
		switch (response.status) {
				case 429:
					errorDiv.textContent = "Try again in a minute, rate limit exceeded";
					break;
				case 403:
					errorDiv.textContent = "You have been banned.";
        break;
    	default:
        	errorDiv.textContent = "Network error occurred";
        break;
		}

		}
	});
	</script>
</body>
</html>
